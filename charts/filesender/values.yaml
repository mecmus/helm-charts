# Default values for filesender.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/mecmus/filesender
  tag: "3.3"
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Configuration FileSender
filesender:
  siteUrl: "https://filesender.example.com"
  siteName: "FileSender"
  admin: "testadmin"
  adminEmail: "admin@example.com"
  emailReplyTo: "noreply@example.com"
  defaultTimezone: "Europe/Paris"
  
  # Stockage des fichiers
  storage:
    type: "filesystem"
    path: "/var/www/files"
  
  # Limites
  maxTransferSize: "107374182400"  # 100GB
  maxTransferFiles: 100
  defaultTransferDaysValid: 20
  maxTransferDaysValid: 60
  
  # TeraSender (upload haute vitesse)
  terasender:
    enabled: true
    advanced: false
    workerCount: 6
    startMode: "multiple"
  
  # Encryption
  encryption:
    enabled: true
    mandatory: false
    minPasswordLength: 12
    mustHaveUpperAndLowerCase: true
    mustHaveNumbers: true
    mustHaveSpecialCharacters: true
  
  # Guest/Invités
  guest:
    enabled: true
    defaultDaysValid: 20
    maxDaysValid: 20
    minDaysValid: 1
    maxRecipients: 50
    limitPerUser: 50
  
  # Sécurité
  security:
    forceSSL: true
    useStrictCSP: true
    banExtension: "exe,bat"

# Configuration SimpleSAMLphp
simplesamlphp:
  adminPassword: ""  # Sera généré si vide
  secretSalt: ""     # Sera généré si vide
  authType: "fake"   # saml, shibboleth, fake
  authenticationSource: "default-sp"
  uidAttribute: "eduPersonTargetedID"
  emailAttribute: "mail"
  nameAttribute: "cn"
  
  # Pour tests avec utilisateurs locaux
  localUsers:
    enabled: true
    users:
      - username: "testuser"
        password: ""  # Sera généré si vide
        email: "test@example.com"
        uid: "testuser"
      - username: "testadmin"
        password: ""  # Sera généré si vide
        email: "testadmin@example.com"
        uid: "testadmin"
  
  # Configuration IdP
  idp:
    entityId: ""
    ssoUrl: ""
    certificate: ""

# Configuration PostgreSQL
postgresql:
  # Utiliser une base externe
  external:
    enabled: false
    host: ""
    port: 5432
    database: "filesender"
    username: "filesender"
    password: ""
    existingSecret: ""
    secretKey: "password"
  
  # Déployer PostgreSQL dans le cluster
  internal:
    enabled: true
    image:
      repository: postgres
      tag: "15-alpine"
      pullPolicy: IfNotPresent
    database: "filesender"
    username: "filesender"
    password: ""  # Sera généré si vide
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"
    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""
      accessMode: ReadWriteOnce

# Persistence pour les fichiers uploadés
persistence:
  enabled: true
  size: 100Gi
  storageClass: ""
  accessMode: ReadWriteOnce

# Configuration Nginx (intégré dans l'image)
nginx:
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "200m"

# Service
service:
  type: ClusterIP
  port: 80

# Ingress
ingress:
  enabled: true
  className: ""
  annotations: {}
    # For nginx-ingress controller, these annotations help with HTTPS:
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # For cert-manager with Let's Encrypt:
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: filesender.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: filesender-tls
  #    hosts:
  #      - filesender.example.com

# Resources pour le conteneur FileSender
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# CronJob pour le nettoyage
cleanup:
  enabled: true
  schedule: "0 2 * * *"

# Probes
livenessProbe:
  enabled: true
  httpGet:
    path: /health
    port: 80
    scheme: HTTP
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 3
  
readinessProbe:
  enabled: true
  httpGet:
    path: /health
    port: 80
    scheme: HTTP
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3

nodeSelector: {}
tolerations: []
affinity: {}
