{{- if not .Values.existingSecrets.enketo }}
{{- $enketoSecretName := printf "%s-enketo" (include "odk-central.fullname" .) }}
{{- $existingEnketo := lookup "v1" "Secret" .Release.Namespace $enketoSecretName }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $enketoSecretName }}
  labels:
    {{- include "odk-central.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  enketo-secret: {{ if $existingEnketo }}{{ index $existingEnketo.data "enketo-secret" | quote }}{{ else }}{{ randAlphaNum 64 | b64enc | quote }}{{ end }}
  enketo-less-secret: {{ if $existingEnketo }}{{ index $existingEnketo.data "enketo-less-secret" | quote }}{{ else }}{{ randAlphaNum 32 | b64enc | quote }}{{ end }}
  enketo-api-key: {{ if $existingEnketo }}{{ index $existingEnketo.data "enketo-api-key" | quote }}{{ else }}{{ randAlphaNum 128 | b64enc | quote }}{{ end }}
---
{{- end }}
{{- if not .Values.existingSecrets.postgres }}
{{- $postgresSecretName := printf "%s-postgres" (include "odk-central.fullname" .) }}
{{- $existingPostgres := lookup "v1" "Secret" .Release.Namespace $postgresSecretName }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $postgresSecretName }}
  labels:
    {{- include "odk-central.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  password: {{ if $existingPostgres }}{{ index $existingPostgres.data "password" | quote }}{{ else }}{{ randAlphaNum 32 | b64enc | quote }}{{ end }}
---
{{- end }}
{{- if and .Values.smtp2graph.enabled (not .Values.existingSecrets.smtp2graph) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "odk-central.fullname" . }}-smtp2graph
  labels:
    {{- include "odk-central.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  tenant-id: {{ .Values.smtp2graph.tenantId | quote }}
  client-id: {{ .Values.smtp2graph.clientId | quote }}
  client-secret: {{ .Values.smtp2graph.clientSecret | quote }}
  from-address: {{ .Values.smtp2graph.fromAddress | quote }}
---
{{- end }}
{{- if and .Values.oidc.enabled (not .Values.existingSecrets.oidc) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "odk-central.fullname" . }}-oidc
  labels:
    {{- include "odk-central.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  client-id: {{ .Values.oidc.clientId | quote }}
  client-secret: {{ .Values.oidc.clientSecret | quote }}
---
{{- end }}
{{- if and .Values.s3.enabled (not .Values.existingSecrets.s3) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "odk-central.fullname" . }}-s3
  labels:
    {{- include "odk-central.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  access-key: {{ .Values.s3.accessKey | quote }}
  secret-key: {{ .Values.s3.secretKey | quote }}
{{- end }}
